# Deployment

A Smart Contract must be deployed to an Algorand network to be used. Once there it 
gets an "App Id." This is then used in Application Call transactions, sent to an
Algorand node, to invoke a Smart Contract program.

The project templates include the following code. This page explains the relevant sections.

## Connecting to the node

When using the Algorand sandbox, the default URL for the Algod web API is ```http://localhost:4001```
The authentication token is ```aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa```

Algorand for Visual Studio depends on Algorand2, the .NET SDK for Algorand. These provide a utility
for connecting to Algorand, which using the above credential is as follows:

```csharp

    var httpClient = HttpClientConfigurator.ConfigureHttpClient(@"http://localhost:4001", "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa");
    algodApiInstance = new DefaultApi(httpClient);
```    

```DefaultApi``` is a typical HTTP proxy class as you would expect for Web APIs, REST servers, and the like.
This provides the main API for calling into the Algorand node. 

The project templates provide examples of this boilerplate for you.

Because interaction with the node needs to be carried out by one or more ```Account``` entities,
the boilerplate examples create three accounts. The mnemonics for the secret keys 
need to be replaced there with those provided by your sandbox. Please see the 
[main readme](../README.md) for how to obtain these.

The code to create the accounts is as follows:

```csharp
   string creatorMnemonic = "blast enable inside tumble trigger rich trust wreck buyer tool athlete idea dawn volume joke maze include work unhappy game lesson vault language ability prepare";
   string userMnemonic = "noise yard remind exotic spy save express stage float ticket gather oval clever local donor miracle elbow fault champion virus rain nature discover abandon employ";
   string user2Mnemonic = "genius genuine bread weekend rigid wild layer crumble delay tennis again popular glove across fever since space display gift upset dust close chunk ability chapter";

   //get accounts based on the above private keys using the .NET SDK
   creator = new Account(creatorMnemonic);
   user = new Account(userMnemonic);
   user2 = new Account(user2Mnemonic);
```

Note that the ``Algorand Console Template for Sandbox`` allows automatic use of the Sandbox accounts without the need to set account mnemonics.

## Finding the contract

The Smart Contract to be deployed is automatically generated by Algorand for Visual Studio. It is an
```ICompiledContract```. These are found under the analyzers node for Algorand for Visual Studio.

![image](https://user-images.githubusercontent.com/33515470/191035352-c4ccf718-2553-4b41-8d88-cc62110b0356.png)

The namespace is the filename of the C# file where the C# Smart Contract is located, 
and the class name is the name of the SmartContract itself.

For example, if a C# Smart Contract called "AddTwoNumbers" was located in a C# file
called "NumberContracts", then the ```ICompiledContract``` will be called 
```NumberContracts.AddTwoNumbers```.


## Deploy the contract

Algorand for Visual Studio makes deploying a contract completely trivial.The following example is
taken from the Algorand Console App template:

First instantiate the ICompiledContract:

```csharp
    var composedBytes = new ComposedBytesOperation.ComposedBytesOperation();
```

then, deploy it:

```csharp
   ulong? composedBytesApp = await composedBytes.Deploy(creator, algodApiInstance);
```

The ```composedBytesApp``` is a uint64 identifying the 'app' (Smart Contract). This is 
then used to call it, pass it as a reference, and so on.

## Fund the contract if necessary

Smart Contracts can issue their own transactions, when invoked, and if the
pooled fees included with the invoking transaction(s) do not cover the required 
amount, then the Smart Contract may need its own funds, or if the Smart Contract
tries to pay out then it may need its own funds. 

A Smart Contract app id also represents an Account belonging to that instance of 
the Smart Contract on that network. Funds can be sent to it by making a Payment
transaction to that Account.

In the Algorand Console App template, the SplitPayment contract makes payments
out, and being able to issue payments at allrequires a minimum balance of 100000 
micro-Algos. 

Again, Algorand for Visual Studio makes funding a Smart Contract trivial:

```csharp
    await creator.FundContract(splitPaymentApp.Value, 100000, algodApiInstance);
```

This simply tells the ```creator``` account to fund the ```splitPaymentApp``` with 
100000 microAlgos. The ```algodApiInstance``` is the ```DefaultApi``` initialised
at the start.


